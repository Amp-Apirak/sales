# Employee Document Management - RBAC Permissions Summary

**อัปเดตล่าสุด:** 2025-10-12
**เวอร์ชัน:** 2.0 (แก้ไขตามความต้องการใหม่)

---

## 📋 ตารางสิทธิ์ทั้งหมด

| Role | การเข้าถึง | เห็นแถบ | อัปโหลด/เพิ่ม | แก้ไข | ดาวน์โหลด/ดู | ลบ |
|------|-----------|---------|--------------|-------|--------------|-----|
| **Executive** | ทุกพนักงาน | ✅ ทั้งหมด | ✅ | ✅ | ✅ | ✅ |
| **Account Management** | ทีมเดียวกัน | ✅ ทั้งหมด | ✅ | ✅ | ✅ | ✅ |
| **Sale Supervisor** | ทีมเดียวกัน | ✅ ทั้งหมด | ✅ | ✅ | ✅ | ❌ |
| **Seller** | ตัวเอง | ✅ ทั้งหมด | ✅ | ✅ | ✅ | ✅ |
| **Engineer** | ตัวเอง | ✅ ทั้งหมด | ✅ | ✅ | ✅ | ✅ |

---

## 🔍 รายละเอียดแต่ละ Role

### 1. Executive (ผู้บริหาร)

**สิทธิ์เต็มทั้งระบบ**

- ✅ เข้าถึงเอกสารของ **ทุกพนักงาน** ในองค์กร
- ✅ เห็นแถบ **"เอกสารแนบ"** และ **"ลิงก์เอกสาร"** ทุกคน
- ✅ อัปโหลดเอกสารให้พนักงานคนใดก็ได้
- ✅ เพิ่มลิงก์เอกสารให้พนักงานคนใดก็ได้
- ✅ แก้ไขเอกสาร/ลิงก์ทั้งหมด
- ✅ ดาวน์โหลดเอกสารทั้งหมด
- ✅ **ลบเอกสาร/ลิงก์ได้** (สิทธิ์เต็ม)

**ตัวอย่าง Use Case:**
- CEO ต้องการตรวจสอบเอกสารสัญญาของพนักงานทุกคน
- HR Executive จัดการเอกสารบุคคลของทุกแผนก

---

### 2. Account Management (จัดการบัญชี/HR)

**สิทธิ์เต็มในทีมที่ดูแล**

- ✅ เข้าถึงเอกสารของ **พนักงานในทีมเดียวกัน/สังกัดเดียวกัน**
- ✅ เห็นแถบ **"เอกสารแนบ"** และ **"ลิงก์เอกสาร"** ของพนักงานในทีม
- ✅ อัปโหลดเอกสารให้พนักงานในทีม
- ✅ เพิ่มลิงก์เอกสารให้พนักงานในทีม
- ✅ แก้ไขเอกสาร/ลิงก์ของพนักงานในทีม
- ✅ ดาวน์โหลดเอกสารของพนักงานในทีม
- ✅ **ลบเอกสาร/ลิงก์ได้** (สำหรับการจัดการ HR)

**ตัวอย่าง Use Case:**
- HR Manager ดูแลเอกสารของแผนก Sales ทั้งหมด
- Account Manager จัดการเอกสารลูกค้าของทีม

**Team Switching:**
- หาก Account Management มีหลายทีม สามารถเลือก "ALL" หรือทีมเฉพาะ
- เข้าถึงได้เฉพาะพนักงานในทีมที่ตนดูแล

---

### 3. Sale Supervisor (หัวหน้าทีมขาย)

**สิทธิ์จัดการในทีม แต่ไม่สามารถลบ**

- ✅ เข้าถึงเอกสารของ **พนักงานในทีมเดียวกัน**
- ✅ เห็นแถบ **"เอกสารแนบ"** และ **"ลิงก์เอกสาร"** ของพนักงานในทีม
- ✅ อัปโหลดเอกสารให้พนักงานในทีม
- ✅ เพิ่มลิงก์เอกสารให้พนักงานในทีม
- ✅ แก้ไขเอกสาร/ลิงก์ของพนักงานในทีม
- ✅ ดาวน์โหลดเอกสารของพนักงานในทีม
- ❌ **ไม่สามารถลบเอกสาร/ลิงก์ได้** (ป้องกันการลบโดยไม่ตั้งใจ)

**ตัวอย่าง Use Case:**
- Sale Supervisor ตรวจสอบ CV ของทีมขาย
- เพิ่มลิงก์ Google Drive สำหรับเอกสาร training

**หมายเหตุ:**
- ไม่มีปุ่ม "ลบ" ในหน้า DataTable
- หากต้องการลบ ต้องขอ Executive หรือ Account Management

---

### 4. Seller (พนักงานขาย)

**สิทธิ์เต็มสำหรับเอกสารตัวเอง**

- ✅ เข้าถึงเอกสารของ **ตัวเองเท่านั้น**
- ✅ เห็นแถบ **"เอกสารแนบ"** และ **"ลิงก์เอกสาร"** ของตัวเอง
- ✅ อัปโหลดเอกสารส่วนตัว (CV, ใบประกาศ, etc.)
- ✅ เพิ่มลิงก์เอกสารส่วนตัว
- ✅ แก้ไขเอกสาร/ลิงก์ของตัวเอง
- ✅ ดาวน์โหลดเอกสารของตัวเอง
- ✅ **ลบเอกสาร/ลิงก์ของตัวเองได้**

**ตัวอย่าง Use Case:**
- Seller อัปโหลด CV ใหม่ของตัวเอง
- เพิ่มลิงก์ Portfolio บน Google Drive
- ลบเอกสารเก่าที่ไม่ใช้แล้ว

**หมายเหตุ:**
- เมื่อดูข้อมูลพนักงานคนอื่น จะไม่เห็นแถบเอกสาร
- เมื่อดูข้อมูลตัวเอง จะเห็นแถบเอกสารครบ

---

### 5. Engineer (วิศวกร/ช่างเทคนิค)

**สิทธิ์เต็มสำหรับเอกสารตัวเอง (เหมือน Seller)**

- ✅ เข้าถึงเอกสารของ **ตัวเองเท่านั้น**
- ✅ เห็นแถบ **"เอกสารแนบ"** และ **"ลิงก์เอกสาร"** ของตัวเอง
- ✅ อัปโหลดเอกสารส่วนตัว (ใบอนุญาต, ใบประกาศ, etc.)
- ✅ เพิ่มลิงก์เอกสารส่วนตัว
- ✅ แก้ไขเอกสาร/ลิงก์ของตัวเอง
- ✅ ดาวน์โหลดเอกสารของตัวเอง
- ✅ **ลบเอกสาร/ลิงก์ของตัวเองได้**

**ตัวอย่าง Use Case:**
- Engineer อัปโหลดใบอนุญาตประกอบวิชาชีพ
- เพิ่มลิงก์ Portfolio ผลงาน
- อัปเดตเอกสารใหม่และลบของเก่า

---

## 🔐 การตรวจสอบสิทธิ์ (RBAC Logic)

### Frontend (view_employees.php)

```php
// ตรวจสอบสิทธิ์การเข้าถึงเอกสาร
$canAccessDocuments = false;
$canManageDocuments = false;
$canDelete = false;

if ($role === 'Executive') {
    $canAccessDocuments = true;
    $canManageDocuments = true;
    $canDelete = true;

} elseif ($role === 'Account Management') {
    // เช็คว่าพนักงานอยู่ในทีมที่ดูแล
    $canAccessDocuments = (ในทีมเดียวกัน);
    $canManageDocuments = $canAccessDocuments;
    $canDelete = $canAccessDocuments;

} elseif ($role === 'Sale Supervisor') {
    // เช็คว่าพนักงานอยู่ในทีมที่ดูแล
    $canAccessDocuments = (ในทีมเดียวกัน);
    $canManageDocuments = $canAccessDocuments;
    $canDelete = false; // ❌ ไม่สามารถลบ

} elseif ($role === 'Seller' || $role === 'Engineer') {
    // เช็คว่าเป็นเอกสารของตัวเอง
    $isOwnProfile = ($employee_id === $user_id);
    $canAccessDocuments = $isOwnProfile;
    $canManageDocuments = $isOwnProfile;
    $canDelete = $isOwnProfile;
}
```

### JavaScript (ซ่อนปุ่มลบ)

```javascript
// ตัวแปร PHP ส่งให้ JavaScript
var canDelete = <?php echo json_encode($canDelete); ?>;

// สร้างปุ่มจัดการ
var actionButtons = '<button>ดาวน์โหลด</button>';

// แสดงปุ่มลบเฉพาะผู้ที่มีสิทธิ์
if (canDelete) {
    actionButtons += '<button>ลบ</button>';
}
```

---

## 📊 ตัวอย่างการใช้งาน

### สถานการณ์ที่ 1: Executive ดูเอกสารพนักงาน

1. Executive Login เข้าระบบ
2. ไปที่หน้า Employee Details ของพนักงานคนใดก็ได้
3. **เห็นแถบ:** ข้อมูลทั่วไป, เอกสารแนบ, ลิงก์เอกสาร ✅
4. **ปุ่ม:** อัปโหลด, ดาวน์โหลด, ลบ ✅

---

### สถานการณ์ที่ 2: Sale Supervisor ดูเอกสารทีม

1. Sale Supervisor (ทีม A) Login เข้าระบบ
2. ดูพนักงานในทีม A → **เห็นแถบเอกสาร** ✅
3. ดูพนักงานในทีม B → **ไม่เห็นแถบเอกสาร** ❌
4. **ปุ่มในทีม A:** อัปโหลด, ดาวน์โหลด (ไม่มีลบ) ✅

---

### สถานการณ์ที่ 3: Seller ดูเอกสารตัวเอง

1. Seller Login เข้าระบบ
2. ดูข้อมูลตัวเอง → **เห็นแถบเอกสาร** ✅
3. ดูข้อมูลพนักงานคนอื่น → **ไม่เห็นแถบเอกสาร** ❌
4. **ปุ่มของตัวเอง:** อัปโหลด, ดาวน์โหลด, ลบ ✅

---

### สถานการณ์ที่ 4: Account Management จัดการเอกสารทีม

1. Account Management (ดูแลทีม Sales + IT) Login
2. Switch Team = "ALL" → เห็นเอกสารทั้ง Sales และ IT
3. Switch Team = "Sales" → เห็นเฉพาะ Sales
4. **ปุ่ม:** อัปโหลด, ดาวน์โหลด, ลบ ✅ (เหมือน Executive)

---

## 🎯 สรุปความแตกต่าง

| เปรียบเทียบ | Executive | Account Mgmt | Sale Supervisor | Seller/Engineer |
|------------|-----------|--------------|----------------|-----------------|
| **ขอบเขต** | ทุกคน | ทีมเดียวกัน | ทีมเดียวกัน | ตัวเอง |
| **เห็นแถบ** | ทุกคน | ทีมเดียวกัน | ทีมเดียวกัน | ตัวเอง |
| **เพิ่ม/แก้ไข** | ทุกคน | ทีมเดียวกัน | ทีมเดียวกัน | ตัวเอง |
| **ดาวน์โหลด** | ทุกคน | ทีมเดียวกัน | ทีมเดียวกัน | ตัวเอง |
| **ลบ** | ✅ ได้ | ✅ ได้ | ❌ ไม่ได้ | ✅ ได้ |

**หลักการ:**
- **Executive & Account Management**: สิทธิ์บริหารจัดการเต็ม (รวมลบ)
- **Sale Supervisor**: จัดการได้ แต่ไม่ลบ (ป้องกันความผิดพลาด)
- **Seller/Engineer**: จัดการตัวเองได้เต็มที่ (รวมลบ)

---

## 🧪 วิธีทดสอบ

### Test Case 1: Executive
```
Login: executive@example.com
Action: ไปดูพนักงานใดก็ได้
Expected: เห็น 3 แถบ, ปุ่มลบมี ✅
```

### Test Case 2: Account Management
```
Login: accountmgmt@example.com (ดูแลทีม A)
Action: ดูพนักงานในทีม A
Expected: เห็น 3 แถบ, ปุ่มลบมี ✅
Action: ดูพนักงานในทีม B
Expected: เห็นแค่ "ข้อมูลทั่วไป" ❌
```

### Test Case 3: Sale Supervisor
```
Login: supervisor@example.com (ทีม A)
Action: ดูพนักงานในทีม A
Expected: เห็น 3 แถบ, ปุ่มลบไม่มี ❌
```

### Test Case 4: Seller
```
Login: seller@example.com (user_id = xxx)
Action: ดูข้อมูลตัวเอง (employee_id = xxx)
Expected: เห็น 3 แถบ, ปุ่มลบมี ✅
Action: ดูข้อมูลคนอื่น
Expected: เห็นแค่ "ข้อมูลทั่วไป" ❌
```

---

## 📌 หมายเหตุสำคัญ

1. **Sale Supervisor ไม่มีปุ่มลบ** เพราะ:
   - ป้องกันการลบเอกสารสำคัญโดยไม่ตั้งใจ
   - เอกสารพนักงานควรดูแลโดย HR/Executive
   - หากต้องการลบ ให้ติดต่อ Account Management หรือ Executive

2. **Seller/Engineer ลบได้** เพราะ:
   - เป็นเอกสารส่วนตัวของตนเอง
   - มีสิทธิ์จัดการข้อมูลส่วนบุคคล
   - ตามหลัก PDPA (ข้อมูลส่วนบุคคล)

3. **Account Management = Full Access ในทีม** เพราะ:
   - ทำหน้าที่ HR/บุคคล
   - ต้องจัดการเอกสารลูกจ้างครบวงจร
   - รวมถึงการลบเอกสารที่หมดอายุ/ผิดพลาด

---

## 🔄 การเปลี่ยนแปลงจากเวอร์ชันเดิม

### เวอร์ชัน 1.0 (เดิม)
- ✅ Executive: เข้าถึงทุกคน
- ✅ Sale Supervisor: เข้าถึงทีมเดียวกัน
- ❌ Seller: ไม่เห็นแถบเอกสาร
- ❌ Engineer: ไม่เห็นแถบเอกสาร
- ❌ Account Management: ไม่มี

### เวอร์ชัน 2.0 (ปัจจุบัน)
- ✅ Executive: เข้าถึงทุกคน, ลบได้
- ✅ **Account Management: เข้าถึงทีมเดียวกัน, ลบได้** (ใหม่)
- ✅ Sale Supervisor: เข้าถึงทีมเดียวกัน, **ลบไม่ได้**
- ✅ **Seller: เห็นของตัวเอง, ลบได้** (ใหม่)
- ✅ **Engineer: เห็นของตัวเอง, ลบได้** (ใหม่)

---

**เอกสารนี้สร้างขึ้นเพื่อ:** อธิบายสิทธิ์การเข้าถึงระบบจัดการเอกสารพนักงานอย่างชัดเจน
**ติดต่อ:** หากมีคำถามหรือต้องการปรับเปลี่ยนสิทธิ์ กรุณาติดต่อ System Administrator
